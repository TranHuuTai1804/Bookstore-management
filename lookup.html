<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipts</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abel&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/home.css">
    <link rel="stylesheet" href="./assets/css/lookup.css">
</head>
<body>
    <header class="header">
        <div class="navbar">
            <div class="navbar-left">
                <a href="/home"><img src="/img/logo.svg" alt=""></a>
                <ul>
                    <li><a href="/home">Home</a></li>
                    <li><a href="#">About us</a></li>
                    <li><a href="#">Staff</a></li>
                </ul>
            </div>

            <div class="navbar-right">
                <button class="logout"><a href="/">Log Out</a></button>
            </div>
        </div>
    </header>

    <!-- Block Book Entry Form -->
    <div class="book-entry-form">
        <h2>Book LookUp</h2>
    </div>

    <!-- Seacch , Shortlist -->
    <div class="search-container">
        <div class="row">
            <input type="text" id="search-input" class="search-input" placeholder="Search books...">
            <div class="result-ip">
            </div>
        </div>
        

        <div class="search-btns">
            <button class="filter-btn" onclick="filterByCategory('Văn học thiếu nhi', this)">Văn học thiếu nhi</button>
            <button class="filter-btn" onclick="filterByCategory('Tiểu thuyết', this)">Tiểu thuyết</button>
            <button class="filter-btn" onclick="filterByCategory('Thơ ca', this)">Thơ ca</button>
            <button class="filter-btn" onclick="filterByCategory('Hồi ký', this)">Hồi ký</button>
            <button class="filter-btn" onclick="filterByCategory('Hot', this)">Hot</button>
            <button id="allBtn" class="filter-btn" onclick="showDefaultList(this)">Tất cả</button>
        </div>
    </div>


        <div class="book-container">
            <!-- Sách sẽ được chèn động từ JavaScript -->
        </div>



    <button class="open-menu" onclick="toggleMenu()">></button>

    <!-- Overlay -->
    <div id="overlay" class="overlay"></div>

    <!-- Menu Section -->
    <div id="hero-menu" class="menu-ovl" style="display: none;">
        <button><a href="/bookempty">Book Entry Form</a></button>
        <button><a href="/bookinvoice">Book Invoice</a></button>
        <button><a href="lookup">Book Lookup</a></button>
        <button><a href="/receipts">Receipt</a></button>
        <button><a href="/report">Monthly Report</a></button>
        <button><a href="/edit">Edit Regulations</a></button>
    </div>

<<<<<<< HEAD

    <script>

    // Khởi tạo mảng chứa tên sách
    let bookTitles = [];

    // Hàm lấy danh sách sách từ API và cập nhật mảng bookTitles
    async function fetchBookTitles() {
        try {
            const response = await fetch('/api/books');
            if (!response.ok) {
                throw new Error('Failed to fetch books');
            }
            const books = await response.json();

            // Cập nhật mảng bookTitles với danh sách tên sách
            bookTitles = books.map(book => book.title);

            // Đảm bảo rằng kết quả được hiển thị sau khi dữ liệu đã được lấy
            console.log('Danh sách tên sách hiện tại:', bookTitles);

        } catch (error) {
            console.error('Error fetching books:', error);
        }
    }

    // Gọi hàm fetchBookTitles để lấy dữ liệu và cập nhật mảng ngay khi trang được tải
    document.addEventListener('DOMContentLoaded', async () => {
        await fetchBookTitles();  // Đảm bảo dữ liệu được tải trước khi cho phép tìm kiếm
    });

    // Định nghĩa các phần tử trong DOM
    const resultIp = document.querySelector(".result-ip");
    const searchInput = document.querySelector(".search-input");

    // Xử lý sự kiện keyup khi người dùng nhập vào ô tìm kiếm
    searchInput.onkeyup = function () {
        let result = [];
        let input = searchInput.value;

        // Nếu input có dữ liệu
        if (input.length) {
            result = bookTitles.filter((keyword) => {
                return keyword.toLowerCase().includes(input.toLowerCase());
            });

            // Hiển thị kết quả tìm kiếm
            display(result);
        }

        // Nếu không có kết quả, xóa danh sách kết quả
        if (!input.length || !result.length) {
            resultIp.innerHTML = '';
        }
    };

    // Hàm hiển thị kết quả tìm kiếm
    function display(result) {
        const content = result.map((list) => {
            return "<li onclick=selectInput(this)>" + list + "</li>";
        });

        // Thêm danh sách vào resultIp
        resultIp.innerHTML = "<ul>" + content.join('') + "</ul>";
    }

    // Hàm khi người dùng chọn kết quả tìm kiếm
    function selectInput(list) {
        searchInput.value = list.innerHTML;
        resultIp.innerHTML = '';  // Xóa kết quả sau khi chọn
    }

    // Hàm hiển thị danh sách mặc định
    async function showDefaultList(button = null) {
        try {
            // Gọi API để lấy tất cả sách
            const response = await fetch('/api/books');
            if (!response.ok) {
                throw new Error('Failed to fetch books');
            }
            const books = await response.json();

            // Hiển thị danh sách mặc định
            const bookContainer = document.querySelector('.book-container');
            bookContainer.innerHTML = ''; // Xóa nội dung cũ nếu có

            books.forEach(book => {
                const bookItem = document.createElement('div');
                bookItem.className = 'book-item';
                bookItem.innerHTML = `
                    <img src="${book.img || '/img/default-book.jpg'}" alt="${book.title}" class="book-image">
                    <h3 class="book-title">${book.title}</h3>
                    <p class="book-price">$${book.price}</p>
                    <div class="progress-container">
                        <span class="progress-text">${book.quantity}/30</span>
                        <div class="progress-bar" style="width: ${(book.quantity / 30) * 100}%;"></div>
                    </div>
                `;
                bookContainer.appendChild(bookItem);
            });

            // Cập nhật nút active
            updateActiveButton(button);
        } catch (error) {
            console.error('Error fetching books:', error);
        }
    }

    // Hàm hiển thị danh sách sách theo thể loại
    async function filterByCategory(category, button) {
        try {
            // Gọi API để lấy tất cả sách
            const response = await fetch('/api/books');
            if (!response.ok) {
                throw new Error('Failed to fetch books');
            }
            const books = await response.json();

            // Lọc sách theo thể loại
            const filteredBooks = books.filter(book =>
                category === 'Hot'
                    ? book.quantity < 10 // Logic riêng cho "Hot"
                    : book.category === category
            );

            const bookContainer = document.querySelector('.book-container');
            bookContainer.innerHTML = ''; // Xóa nội dung cũ nếu có

            // Kiểm tra nếu không có sách nào
            if (filteredBooks.length === 0) {
                const noBooksMessage = document.createElement('p');
                noBooksMessage.textContent = 'Không có sách trong danh mục này.';
                bookContainer.appendChild(noBooksMessage);
                return;
            }

            // Tạo bảng danh sách sách
            const table = document.createElement('table');
            table.className = 'book-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Author</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody>
                    ${filteredBooks.map((book, index) => `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${book.title}</td>
                            <td>${book.category}</td>
                            <td>${book.author}</td>
                            <td>${book.quantity}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            bookContainer.appendChild(table);

            // Cập nhật nút active
            updateActiveButton(button);
        } catch (error) {
            console.error('Error fetching books by category:', error);
        }
    }

    // Hàm cập nhật trạng thái nút active
    function updateActiveButton(button) {
        // Xóa class active khỏi tất cả nút
        const buttons = document.querySelectorAll('.filter-btn');
        buttons.forEach(btn => btn.classList.remove('active'));

        // Gán class active cho nút hiện tại
        if (button) {
            button.classList.add('active');
        }
    }

    // Khi trang được tải, hiển thị danh sách mặc định
    document.addEventListener('DOMContentLoaded', () => {
        showDefaultList(document.getElementById('allBtn'));
    });



    // Gọi API lấy dữ liệu sách
    // async function fetchBooks() {
    //     try {
    //         const response = await fetch('/api/books');
    //         if (!response.ok) {
    //             throw new Error('Failed to fetch books');
    //         }
    //         const books = await response.json();

    //         // Hiển thị sách trên giao diện
    //         const bookContainer = document.querySelector('.book-container');
    //         bookContainer.innerHTML = ''; // Xóa nội dung cũ nếu có

    //         books.forEach(book => {
    //             const maxStock = 30; 
    //             const stock = book.quantity; 
    //             const stockPercentage = (stock / maxStock) * 100; // Tính phần trăm số sách còn lại

    //             // Tạo phần tử HTML cho mỗi cuốn sách
    //             const bookItem = document.createElement('div');
    //             bookItem.className = 'book-item';
    //             bookItem.innerHTML = `
    //                 <img src="${book.img || '/img/default-book.jpg'}" alt="${book.title}" class="book-image">
    //                 <h3 class="book-title">${book.title}</h3>
    //                 <p class="book-price">$${book.price}</p>
    //                 <div class="progress-container">
    //                         <span class="progress-text">${stock}/${maxStock}</span>
    //                     <div class="progress-bar" style="width: ${stockPercentage}%;">
    //                     </div>
    //                 </div>
    //             `;
    //             // Thêm cuốn sách vào container
    //             bookContainer.appendChild(bookItem);
    //         });
    //     } catch (error) {
    //         console.error('Error fetching books:', error);
    //     }
    // }

    // // Gọi hàm khi trang được tải
    // document.addEventListener('DOMContentLoaded', fetchBooks);


        function toggleMenu() {
            const menu = document.getElementById("hero-menu");
            const overlay = document.getElementById("overlay");
            const icon = document.querySelector(".open-menu");
            const body = document.body;

            // Kiểm tra nếu menu đang ẩn
            if (menu.style.display === "none" || menu.style.display === "") {
                menu.style.display = "block"; // Mở menu
                setTimeout(() => {
                    menu.style.left = "0"; // Đặt menu vào vị trí mong muốn với hiệu ứng trượt
                }, 10); // Đảm bảo hiệu ứng trượt được áp dụng
                overlay.style.display = "block"; // Hiện overlay
                icon.textContent = "<"; // Đổi icon thành '<'

                // Thêm lớp menu-open để di chuyển icon
                body.classList.add("menu-open");
            } else {
                menu.style.left = "-30%"; // Ẩn menu với hiệu ứng trượt
                overlay.style.display = "none"; // Ẩn overlay
                icon.textContent = ">"; // Đổi icon thành '>'

                // Loại bỏ lớp menu-open để di chuyển icon về vị trí ban đầu
                body.classList.remove("menu-open");

                setTimeout(() => {
                    menu.style.display = "none"; // Ẩn menu sau khi trượt hoàn tất
                }, 300); // Thời gian trượt hoàn tất trước khi ẩn menu
            }
        }

        // Ẩn thanh cuộn khi người dùng lướt lên hoặc xuống
        const menuOv = document.getElementById("hero-menu");

        menuOv.addEventListener('scroll', function() {
            menuOv.style.scrollbarWidth = 'none'; // Ẩn thanh cuộn khi lướt
            clearTimeout(menuOv.scrollTimeout);
            
            menuOv.scrollTimeout = setTimeout(function() {
                menuOv.style.scrollbarWidth = 'thin'; // Hiển thị lại thanh cuộn khi ngừng lướt
            }, 100); // Ẩn thanh cuộn khi lướt và hiển thị lại sau khi ngừng
        });

    </script>
=======
    <script src="assets/js/lookup.js"></script>
>>>>>>> origin/reorganise
</body>
</html>
